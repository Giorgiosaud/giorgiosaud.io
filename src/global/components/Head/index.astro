---
import { getLangFromUrl } from '@i18n/utils'
import Favicons from './Favicons.astro'
import PWA from './PWA.astro'

// Self-hosted fonts via fontsource (faster, no external requests)
import '@fontsource/poppins/400.css'
import '@fontsource/poppins/500.css'
import '@fontsource/poppins/600.css'
import '@fontsource/poppins/700.css'
import '@fontsource/roboto-mono/400.css'
import '@fontsource/roboto-mono/500.css'

export interface Props {
  title?: string
  description?: string
  structuredData?: string
  image?: string | ImageMetadata
}
const {
  title,
  structuredData,
  description = 'This is a web developers Notebook site',
  image = 'https://giorgiosaud.io/opengraph.jpg',
} = Astro.props
const imageUrl = typeof image === 'string' ? image : image?.src || ''
const fixedTitle = `Giorgiosaud.io | ${title || 'Notebook'}`
const lang = getLangFromUrl(Astro.url)
---
<head>
  <!-- Google Tag Manager -->
  <script>
    import { TAG_MANAGER_ID } from "astro:env/client";
    (function(w: Window & { [key: string]: any },d: Document,s: string,l: string,i: string) {  
      w[l] = w[l] || [];
      w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
      var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != 'dataLayer' ? '&l=' + l : '';
      if (j instanceof HTMLScriptElement) {
        j.async = true;
        j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
      }
      f.parentNode?.insertBefore(j, f);
    })(window as Window & { [key: string]: any }, document, 'script', 'dataLayer', TAG_MANAGER_ID || '');
  </script>
  <!-- End Google Tag Manager -->
  <meta charset="UTF-8" />
  <meta
  content="width=device-width, initial-scale=1.0"
  name="viewport"
  />
  <meta
  content="Jorge Saud"
  name="author"
  />
  <meta
  content={Astro.generator}
  name="generator"
  />
  <meta name="description" content={description}>
  <slot name="meta" />
  
  <title>{fixedTitle}</title>

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content={fixedTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url || 'https://giorgiosaud.io/'} />
    <meta property="og:image" content={imageUrl} />
    <meta property="og:site_name" content="Giorgiosaud.io" />
    <meta property="og:locale" content={lang=='en'?'en_US':'es_VE'} />
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={fixedTitle} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={imageUrl} />
    <meta name="twitter:site" content="@giorgiosaud" />
  <Favicons/>
  <PWA />
  <link
  href="/sitemap-index.xml"
  rel="sitemap"
  />
  <script type="speculationrules">
    {
      "prerender": [
      {
        "source": "document",
        "where": {
          "and": [
          { 
            "href_matches": "/*" 
          },
          { 
            "not": {
              "href_matches": "/logout/*" 
            } 
          }
          ]
        },
        "eagerness": "moderate"
      }
      ]
    }
  </script>
  {
    structuredData &&
    <script type="application/ld+json" set:html={structuredData}>
    </script>
  }
  <meta name="robots" content="index, follow" />
  <meta name="theme-color" content="#22223b" />
  <link rel="apple-touch-icon" href="/icons/apple-icon.png" />
  <link rel="alternate" href="https://giorgiosaud.io/" hreflang="en" />
<link rel="alternate" href="https://giorgiosaud.io/es/" hreflang="es" />
</head>