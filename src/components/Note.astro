---
import { Image } from 'astro:assets'
import { getLangFromUrl, useTranslations } from '@i18n/utils'

const lang = getLangFromUrl(Astro.url)
const { note, context = 'no-context' } = Astro.props
const t = useTranslations(lang)
const link = lang === 'es' ? `/es/cuaderno/${note.id}` : `/notebook/${note.id}`
const nameImage = `${note.id}-${context}`
---
<article aria-label={note.data.title} data-link={link} id={nameImage} style="position:relative;">
    <div class="wrapper">
        <div class="title" title={note.data.title}>
            <h2>{note.data.title}</h2>
        </div>
        <figure>
            <Image class="img" src={note.data.cover} alt={note.data.coverAlt} >
        </figure>
        <div class="description" title={note.data.resume}>
            <p>{note.data.resume}</p>
        </div>
    </div>
    <a href={link} class="card-link" aria-label={note.data.title}></a>
</article>
<style define:vars={{nameImage}}>
    article{
        container: note/inline-size;
    }
    .wrapper{
        position: relative;
        --_color:var(--color,light-dark(var(--color-dark),var(--color-light)));
        --_background-color:var(--background-color,light-dark(var(--color-light),var(--color-dark)));
        --_border-radius:var(--border-radius,10px);
        display: grid;
        border-radius: var(--_border-radius);
        background-color: var(--_background-color);
        color: var(--_color);
        width: 100%;
        grid-template-rows: 1fr auto;
        text-decoration: none;
        transition: transform 0.2s cubic-bezier(.4,1.3,.5,1), box-shadow 0.2s cubic-bezier(.4,1.3,.5,1);
    }
    .wrapper:hover, .wrapper:focus-within {
        transform: scale(1.05);
        box-shadow: 0 8px 32px 0 rgba(0,0,0,0.16), 0 3px 12px 0 rgba(0,0,0,0.12);
        z-index: 2;
    }
    .title {
        position: absolute;
        left: 0;
        bottom: 0;
        width: 100%;
        background: rgba(0,0,0,0.5);
        color: #fff;
        z-index: 2;
        padding-block: 0.5rem;
        text-align: center;
        --_padding-inline: var(--padding-inline, 1rem);
        padding-inline: var(--_padding-inline);
        h2{
            --_font-size: var(--font-size, clamp(1rem, 7cqw, 2rem));
            font-size: var(--_font-size);
            text-wrap: balance;
            text-decoration: none;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;  
            overflow: hidden;
            line-height: 1.5;
            max-height: 3.5lh;
        }
    }
    figure{
        margin: 0;
        position: relative;
        img{
            width: 100%;
            display: block;
            height: auto;
        }
    }
    .description{
        display: none;
    }
    .card-link {
        position: absolute;
        inset: 0;
        display: block;
        text-indent: -9999px;
        background: none;
        border: none;
        cursor: pointer;
        z-index: 100;
        pointer-events: auto;
    }
    .wrapper:has(+ .card-link:hover),
    .wrapper:has(+ .card-link:focus) {
        transform: scale(1.05);
        box-shadow: 0 8px 32px 0 rgba(0,0,0,0.16), 0 3px 12px 0 rgba(0,0,0,0.12);
        z-index: 2;
    }

    @container note (min-width: 301px) {
        .wrapper {
            grid-template-rows: none;
            box-shadow: 0 4px 24px 0 rgba(0,0,0,0.10), 0 1.5px 6px 0 rgba(0,0,0,0.08);
            border-radius: 1.25rem;
            padding: 1.25rem 1.25rem 1.5rem 1.25rem;
            gap: 1rem;
            background: var(--_background-color);
            transition: box-shadow 0.2s cubic-bezier(.4,1.3,.5,1), transform 0.2s cubic-bezier(.4,1.3,.5,1);
        }
        .wrapper:hover, .wrapper:focus-within {
            box-shadow: 0 8px 32px 0 rgba(0,0,0,0.16), 0 3px 12px 0 rgba(0,0,0,0.12);
            transform: scale(1.045);
        }
        .title {
            position: static;
            background: none;
            color: inherit;
            text-align: left;
            padding-block: .5rem;
            margin-bottom: 0.5rem;
        }
        .title h2 {
            margin: 0;
        }
        figure {
            margin-bottom: 0.75rem;
            border-radius: 1rem;
            overflow: hidden;
        }
        .description {
            display: block !important;
            --_padding-inline: 0;
            --_padding-block: 0;
            padding-inline: 0;
            padding-block: 0;
        }
        .description p {
            --_font-size: var(--font-size, clamp(.8rem, 5cqw, 1rem));
            font-size: var(--_font-size);
            text-wrap: pretty;
            text-decoration: none;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 4.5lh;
            margin: 0;
        }
    }

    @container note (min-width: 501px) {
        .wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr;
            align-items: stretch;
            padding: 2rem;
            gap:0;
        }
        figure {
            grid-column: 1;
            grid-row: 1/3;
            margin: 0;
            padding: 0;
            align-self: center;
            border-radius: 1rem;
            overflow: hidden;
            min-width: 180px;
            max-width: 220px;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        figure img {
            width: 100%;
            height: auto;
            border-radius: 1rem;
            object-fit: cover;
        }
        .title {
            grid-column: 2;
            grid-row: 1;
            position: static;
            background: none;
            color: inherit;
            text-align: left;
            padding: 0;
            margin: 0;
        }
        .description {
            grid-column: 2;
            grid-row: 2;
            display: block !important;
            align-self: end;
            margin: 0;
        }
        .description p {
            font-size: clamp(1rem, 2vw, 1.2rem);
            margin: 0;
        }
    }

   
</style>
